---
title: 安全算法
author: richard
toc: true
excerpt: 针对网络传输遇到的四个问题，以及对应的解决方案...
categories:
- 数据结构与算法
- 安全算法
---

## 传输数据时的四个问题
1. 窃听
A向B发送的消息可能会在传输途中被X偷看
2. 假冒
A以为向B发送了消息，然而B有可能是X冒充的；反过来，B以为从A那里收到了消息，然而A也有可能是X冒充的。
3. 篡改
即便B确实收到了A发送的消息，但也有可能像右图这样，该消息的内容在途中就被X更改了
4. 事后否认
B从A那里收到了消息，但作为消息发送者的A可能对B抱有恶意，并在事后声称“这不是我发送的消息”


为了应对第一个问题“窃听”，我们会使用"加密"技术。
为了应对第二个问题“假冒”，我们会使用"消息认证码"或"数字签名"技术。
为了应对第三个问题“篡改”，我们同样会使用“消息认证码”或“数字签名”技术。其中“数字签名”技术还可以用于预防第四个问题“事后否认”

## 理解加密

首先，计算机会用由0和1这两个数字表示的二进制来管理所有数据

对计算机来说，数据就是一串有意义的数字罗列。密文也是数字罗列，只不过它是计算机无法理解的无规律的数字罗列。


加密就是用密钥对数据进行数值运算，把数据变成**第三者无法理解的形式**的过程


## 哈希函数 
1. 无论数据规模，输出长度不变
2. 输入的数据相同，那么输出的哈希值也必定相同
3. 即使输入的数据相似，但哪怕它们只有一比特的差别，那么输出的哈希值也会有很大的差异
4. 即使输入的两个数据完全不同，输出的哈希值也有可能是相同的，虽然出现这种情况的概率比较低。这种情况叫作“哈希冲突
5. 不可能从哈希值反向推算出原本的数据。输入和输出不可逆这一点和加密有很大不同。


**哈希函数的算法中具有代表性的是MD5、SHA-1和SHA-2等。其中SHA-2是现在应用较为广泛的一个，而MD5和SHA-1存在安全隐患，不推荐使用**

## 共享密钥加密


加密数据的方法可以分为两种：加密和解密都使用相同密钥的“共享密钥加密”和分别使用不同密钥的“公开密钥加密”

**实现共享密钥加密的算法有凯撒密码、AES、DES、动态口令等，其中AES的应用最为广泛**

问题：密钥有被第三者窃听的风险


因此需要找到可以把密钥安全送出的方法，这就是“密钥分配问题”

要想解决这个问题，可以使用“密钥交换协议”和“公开密钥加密”两种方法。


## 公开密钥加密

公开密钥加密是加密和解密使用不同密钥的一种加密方法。由于使用的密钥不同，所以这种算法也被称为“非对称加密”。加密用的密钥叫作“公开密钥”，解密用的叫作“私有密钥”。

**实现公开密钥加密的算法有RAS算法、椭圆曲线加密算法等，其中使用最为广泛的是RSA算法**



公开密钥的可靠性会出现问题，就是因为A无法判断收到的公开密钥是否来自B(中间人攻击)。要想解决这个问题，就要用到之后会讲到的“数字证书”。

公开密钥加密还有一个问题，那就是加密和解密都比较耗时，所以这种方法不适用于持续发送零碎数据的情况。要想解决这个问题，就要用到“混合加密”。

## 混合加密


共享密钥加密存在无法安全传输密钥的密钥分配问题，公开密钥加密又存在加密解密速度较慢的问题。结合这两种方法以实现互补的一种加密方法就是混合加密。


在混合加密中，要用处理速度较快的共享密钥加密对数据进行加密。不过，加密时使用的密钥，则需要用没有密钥分配问题的公开密钥加密进行处理。


混合加密在安全性和处理速度上都有优势。能够为网络提供通信安全的SSL协议也应用了混合加密方法。SSL是Secure Sockets Layer（安全套接层）的简写，该协议经过版本升级后，现在已正式命名为TLS（TransportLayer Security，传输层安全）

## 迪菲-赫尔曼密钥交换

迪菲-赫尔曼（Diffie-Hellman）密钥交换是一种可以在通信双方之间安全交换密钥的方法。这种方法通过将双方共有的秘密数值隐藏在公开数值相关的运算中，来实现双方之间密钥的安全交换。

合成密钥的方法具有如下特征：

第一，即使持有密钥P和合成的密钥P-S，也无法把密钥S单独取出来。


第二，不管是怎样合成而来的密钥，都可以把它作为新的元素，继续与别的密钥进行合成。比如上图中的这个例子，使用密钥P和密钥P-S，还能合成出新的密钥P-P-S


第三，密钥的合成结果与合成顺序无关，只与用了哪些密钥有关。比如合成密钥B和密钥C后，得到的是密钥B-C，再将其与密钥A合成，得到的就是密钥A-B-C。而合成密钥A和密钥C后，得到的是密钥A-C，再将其与密钥B合成，得到的就是密钥B-A-C。此处的密钥A-B-C和密钥B-A-C是一样的





## 消息认证码

消息认证码可以实现“认证”和“检测篡改”这两个功能。密文的内容在传输过程中可能会被篡改，这会导致解密后的内容发生变化，从而产生误会。消息认证码就是可以预防这种情况发生的机制。


我们以A正要向B发送密文的时候举例
1. A生成了一个用于制作消息认证码的密钥，然后使用安全的方法将密钥发送给了B。
2. A使用密文和密钥生成一个值。此处生成的是7f05。这个由密钥和密文生成的值就是消息认证码，以下简称为MAC（Message Authentication Code）。
3. A将MAC（7f05）和密文(密文使用的是安全的交换方式)发送给B。
4. B也需要使用密文和密钥来生成MAC。经过对比，B可以确认自己计算出来的7f05和A发来的7f05一致
5. B只需使用密钥对密文进行解密即可。最终B成功取得了A发送过来的商品编号abc。



我们可以把MAC想象成是由密钥和密文组成的字符串的“哈希值”。计算MAC的算法有HMAC、OMAC、CMAC等。目前，HMAC的应用最为广泛。


缺点：

在使用消息认证码的过程中，AB双方都可以对消息进行加密并且算出MAC。也就是说，我们无法证明原本的消息是A生成的还是B生成的。

因此，假如A是坏人，他就可以在自己发出消息后声称“这条消息是B捏造的”，而否认自己的行为。如果B是坏人，他也可以自己准备一条消息，然后声称“这是A发给我的消息”。


使用MAC时，生成的一方和检测的一方持有同样的密钥，所以不能确定MAC由哪方生成。这个问题可以用下一节将会讲到的“数字签名”来解决。

## 数字签名

数字签名不仅可以实现消息认证码的认证和检测篡改功能，还可以预防事后否认问题的发生。由于在消息认证码中使用的是共享密钥加密，所以持有密钥的收信人也有可能是消息的发送者，这样是无法预防事后否认行为的。而数字签名是只有发信人才能生成的，因此使用它就可以确定谁是消息的发送者了。


**数字签名的生成使用的是公开密钥加密。**

那就是，虽然使用数字签名后B会相信消息的发送者就是A，但实际上也有可能是X冒充了A

其根本原因在于使用公开密钥加密无法确定公开密钥的制作者是谁。收到的公开密钥上也没有任何制作者的信息。因此，公开密钥有可能是由某个冒充A的人生成的

使用“数字证书”就能解决这个问题。

## 数字证书

公开密钥加密”和“数字签名”无法保证公开密钥确实来自信息的发送者。因此，就算公开密钥被第三者恶意替换，接收方也不会注意到。不过，如果使用本节讲解的数字证书，就能保证公开密钥的正确性


那就是，B得到的公开密钥PC真的来自认证中心吗？

由于公开密钥自身不能表示其制作者，所以有可能是冒充认证中心的X所生成的。也就是说，这里同样存在公开密钥问题

实际上，认证中心的公开密钥PC是以数字证书的形式交付的，会有更高级别的认证中心对这个认证中心署名